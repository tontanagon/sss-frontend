apiVersion: apps/v1
kind: Deployment
metadata:
  name: sss-frontend
  namespace: sss
  # annotations:
  #   keel.sh/policy: force
  #   keel.sh/match-tag: 'true'
  #   keel.sh/trigger: poll
spec:
  progressDeadlineSeconds: 600
  # terminationGracePeriodSeconds: 30
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
  selector:
    matchLabels:
      app: sss-frontend
  template:
    metadata:
      name: sss-frontend
      labels:
        app: sss-frontend
    spec:
      terminationGracePeriodSeconds: 30
      imagePullSecrets:
        - name: regcred
      containers:
        - name: application
          image: registry.mininggarden.com/smart-store-system/frontend:dev
          imagePullPolicy: Always
          env:
          - name: NODE_ENV
            value: production
          envFrom:
            - configMapRef:
                name: frontend-config
            - secretRef:
                name: frontend-secret
          ports:
          - containerPort: 3000
            name: p3000
            protocol: TCP
          resources: {}
          startupProbe:
            httpGet:
              path: /
              port: 3000
            failureThreshold: 1
            periodSeconds: 15
            initialDelaySeconds: 5
            timeoutSeconds: 30
          livenessProbe:
            httpGet:
              path: /
              port: 3000
            failureThreshold: 1
            periodSeconds: 15
            timeoutSeconds: 30
            initialDelaySeconds: 15
          readinessProbe:
            httpGet:
              path: /
              port: 3000
            failureThreshold: 1
            periodSeconds: 15
            timeoutSeconds: 30
            initialDelaySeconds: 15
          lifecycle:
            preStop:
              exec:
                command: ["sleep", "10"]
          # volumeMounts:
          # - name: main-volume
          #   mountPath: /app/public/storage
          #   subPath: api/app/public
      volumes:
      - name: main-volume
        persistentVolumeClaim:
          claimName: sss-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: sss-frontend
  namespace: sss
spec:
  type: ClusterIP
  selector:
    app: sss-frontend
  ports:
    - name: http
      port: 3000
      targetPort: 3000